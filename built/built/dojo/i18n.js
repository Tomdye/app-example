define(["./_base/kernel","require","./has","./_base/array","./_base/config","./_base/lang","./has!host-browser?./_base/xhr","./json","module"],function(e,n,o,r,i,t,a,l,c){o.add("dojo-preload-i18n-Api",1),o.add("dojo-v1x-i18n-Api",1);var u=e.i18n={},f=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,s=function(e,n,o,r){for(var i=[o+r],t=n.split("-"),a="",l=0;l<t.length;l++)a+=(a?"-":"")+t[l],(!e||e[a])&&(i.push(o+a+"/"+r),i.specificity=a);return i},d={},p=function(n,o,r){return r=r?r.toLowerCase():e.locale,n=n.replace(/\./g,"/"),o=o.replace(/\./g,"/"),/root/i.test(r)?n+"/nls/"+o:n+"/nls/"+r+"/"+o},_=e.getL10nName=function(e,n,o){return e=c.id+"!"+p(e,n,o)},h=function(e,n,o,r,i,a){e([n],function(l){var c=t.clone(l.root||l.ROOT),u=s(!l._v1x&&l,i,o,r);e(u,function(){for(var e=1;e<u.length;e++)c=t.mixin(t.clone(c),arguments[e]);var o=n+"/"+i;d[o]=c,c.$locale=u.specificity,a()})})},v=function(e,n){return/^\./.test(e)?n(e):e},g=function(e){var n=i.extraLocale||[];return n=t.isArray(n)?n:[n],n.push(e),n},m=function(n,i,a){if(o("dojo-preload-i18n-Api")){var c=n.split("*"),u="preload"==c[1];if(u&&(d[n]||(d[n]=1,j(c[2],l.parse(c[3]),1,i)),a(1)),u||A(n,i,a))return}var s=f.exec(n),p=s[1]+"/",_=s[5]||s[4],v=p+_,m=s[5]&&s[4],y=m||e.locale||"",x=v+"/"+y,b=m?[y]:g(y),L=b.length,z=function(){--L||a(t.delegate(d[x]))};r.forEach(b,function(e){var n=v+"/"+e;o("dojo-preload-i18n-Api")&&O(n),d[n]?z():h(i,v,p,_,e,z)})};if(o("dojo-preload-i18n-Api")||o("dojo-v1x-i18n-Api"))var y=u.normalizeLocale=function(n){var o=n?n.toLowerCase():e.locale;return"root"==o?"ROOT":o},x=function(e,r){return o("dojo-sync-loader")&&o("dojo-v1x-i18n-Api")?r.isXdUrl(n.toUrl(e+".js")):!0},b=0,L=[],j=u._preloadLocalizations=function(o,i,a,l){function c(e,n){x(e,l)||a?l([e],n):$([e],n,l)}function u(e,n){for(var o=e.split("-");o.length;){if(n(o.join("-")))return;o.pop()}n("ROOT")}function f(){b++}function s(){for(--b;!b&&L.length;)m.apply(null,L.shift())}function p(e,n,o,r){return r.toAbsMid(e+n+"/"+o)}function _(e){e=y(e),u(e,function(a){if(r.indexOf(i,a)>=0){var _=o.replace(/\./g,"/")+"_"+a;return f(),c(_,function(o){function r(o,r,i,a){var c=[],_=[];u(e,function(e){a[e]&&(c.push(n.toAbsMid(o+e+"/"+r)),_.push(p(o,r,e,n)))}),c.length?(f(),l(c,function(){for(var a=c.length-1;a>=0;a--)i=t.mixin(t.clone(i),arguments[a]),d[_[a]]=i;d[p(o,r,e,n)]=t.clone(i),s()})):d[p(o,r,e,n)]=i}for(var i in o){var c,_,h=o[i],v=i.match(/(.+)\/([^\/]+)$/);if(v&&(c=v[2],_=v[1]+"/",h._localized)){var g;if("ROOT"===a){var m=g=h._localized;delete h._localized,m.root=h,d[n.toAbsMid(i)]=m}else g=h._localized,d[p(_,c,a,n)]=h;a!==e&&r(_,c,h,g)}}s()}),!0}return!1})}l=l||n,_(),r.forEach(e.config.extraLocale,_)},A=function(e,n,o){return b&&L.push([e,n,o]),b},O=function(){};if(o("dojo-v1x-i18n-Api")){var z={},M=new Function("__bundle","__checkForLegacyModules","__mid","__amdValue","var define = function(mid, factory){define.called = 1; __amdValue.result = factory || mid;},	   require = function(){define.called = 1;};try{define.called = 0;eval(__bundle);if(define.called==1)return __amdValue;if((__checkForLegacyModules = __checkForLegacyModules(__mid)))return __checkForLegacyModules;}catch(e){}try{return eval('('+__bundle+')');}catch(e){return e;}"),$=function(e,n,o){var i=[];r.forEach(e,function(e){function n(n){var o=M(n,O,e,z);o===z?i.push(d[r]=z.result):(o instanceof Error&&(console.error("failed to evaluate i18n bundle; url="+r,o),o={}),i.push(d[r]=/nls\/[^\/]+\/[^\/]+$/.test(r)?o:{root:o,_v1x:1}))}var r=o.toUrl(e+".js");if(d[r])i.push(d[r]);else{var t=o.syncLoadNls(e);if(t||(t=O(e.replace(/nls\/([^\/]*)\/([^\/]*)$/,"nls/$2/$1"))),t)i.push(t);else if(a)a.get({url:r,sync:!0,load:n,error:function(){i.push(d[r]={})}});else try{o.getText(r,!0,n)}catch(l){i.push(d[r]={})}}}),n&&n.apply(null,i)};O=function(n){for(var o,r=n.split("/"),i=e.global[r[0]],t=1;i&&t<r.length-1;i=i[r[t++]]);return i&&(o=i[r[t]],o||(o=i[r[t].replace(/-/g,"_")]),o&&(d[n]=o)),o},u.getLocalization=function(e,o,r){var i,t=p(e,o,r);return m(t,x(t,n)?n:function(e,o){$(e,o,n)},function(e){i=e}),i}}return t.mixin(u,{dynamic:!0,normalize:v,load:m,cache:d,getL10nName:_})});